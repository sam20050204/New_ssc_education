{% extends 'base/base.html' %}
{% load static %}

{% block title %}Dashboard{% endblock %}

{% block page_heading %}
<div class="page-header">
    <div class="page-header-content">
        <div class="page-title-wrapper">
            <div class="page-icon">ğŸ“Š</div>
            <div>
                <h1 class="page-title">Dashboard Overview</h1>
                <p class="page-subtitle">Welcome back! Here's what's happening.</p>
            </div>
        </div>
        <div class="page-filters">
            <form method="get" class="year-filter-form">
                <label for="year-select">
                    <span class="filter-icon">ğŸ“…</span>
                    <span class="filter-label">Select Year:</span>
                </label>
                <select name="year" id="year-select" class="year-select" onchange="this.form.submit()">
                    <option value="">All Years</option>
                    {% for year in available_years %}
                        <option value="{{ year }}" {% if year|stringformat:"s" == selected_year %}selected{% endif %}>
                            {{ year }}
                        </option>
                    {% endfor %}
                </select>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block content %}

<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon">ğŸ“</div>
        <div class="stat-number">{{ enquiry_count }}</div>
        <div class="stat-label">Total Enquiries</div>
        {% if selected_year %}
            <div class="stat-period">Year {{ selected_year }}</div>
        {% endif %}
    </div>

    <div class="stat-card">
        <div class="stat-icon">ğŸ“</div>
        <div class="stat-number">{{ mscit_count|default:0 }}</div>
        <div class="stat-label">MSCIT Students</div>
        {% if selected_year %}
            <div class="stat-period">Year {{ selected_year }}</div>
        {% endif %}
    </div>

    <div class="stat-card">
        <div class="stat-icon">ğŸ’»</div>
        <div class="stat-number">{{ klic_count|default:0 }}</div>
        <div class="stat-label">KLIC Students</div>
        {% if selected_year %}
            <div class="stat-period">Year {{ selected_year }}</div>
        {% endif %}
    </div>
</div>

<div class="charts-container">
    <div class="chart-container">
        <h3>Course Distribution</h3>
        <canvas id="pieChart"></canvas>
    </div>

    <div class="chart-container">
        <h3>Monthly Admissions</h3>
        <canvas id="barChart"></canvas>
    </div>
</div>

<!-- Pass data to JavaScript -->
<script>
    // Course distribution data from Django
    const courseDistribution = {{ course_distribution|safe }};
    
    // Monthly admissions data from Django
    const monthlyData = {{ monthly_data|safe }};
    
    // Selected year (if any)
    const selectedYear = "{{ selected_year|default:'' }}";
</script>

{% endblock %}

{% block extra_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<script src="{% static 'core/dashboard.js' %}"></script>
{% endblock %}