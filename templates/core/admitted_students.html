{% extends 'base/base.html' %}
{% load static %}

{% block title %}Admitted Students{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'core/admitted_students.css' %}">
{% endblock %}

{% block page_heading %}
<div class="page-header">
    <div class="page-header-content">
        <div class="page-title-wrapper">
            <div class="page-icon">ğŸ“</div>
            <div>
                <h1 class="page-title">Admitted Students</h1>
                <p class="page-subtitle">View and manage all admitted students</p>
            </div>
        </div>
        <div class="page-actions">
            <a href="{% url 'new_admission' %}" class="action-btn primary">
                <span>â•</span> Add New Student
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block content %}

<!-- SEARCH AND FILTERS -->
<div class="filters-container">
    <form method="get" class="filters-form" id="filterForm">
        
        <div class="filter-group search-group">
            <label for="search">ğŸ” Search Student</label>
            <input
                type="text"
                name="search"
                id="search"
                placeholder="Search by name or mobile..."
                value="{{ search }}"
                class="filter-input"
            >
        </div>

        <div class="filter-group">
            <label for="month">ğŸ“… Month</label>
            <select name="month" id="month" class="filter-select">
                <option value="">All Months</option>
                <option value="1" {% if month == "1" %}selected{% endif %}>January</option>
                <option value="2" {% if month == "2" %}selected{% endif %}>February</option>
                <option value="3" {% if month == "3" %}selected{% endif %}>March</option>
                <option value="4" {% if month == "4" %}selected{% endif %}>April</option>
                <option value="5" {% if month == "5" %}selected{% endif %}>May</option>
                <option value="6" {% if month == "6" %}selected{% endif %}>June</option>
                <option value="7" {% if month == "7" %}selected{% endif %}>July</option>
                <option value="8" {% if month == "8" %}selected{% endif %}>August</option>
                <option value="9" {% if month == "9" %}selected{% endif %}>September</option>
                <option value="10" {% if month == "10" %}selected{% endif %}>October</option>
                <option value="11" {% if month == "11" %}selected{% endif %}>November</option>
                <option value="12" {% if month == "12" %}selected{% endif %}>December</option>
            </select>
        </div>

        <div class="filter-group">
            <label for="year">ğŸ“† Year</label>
            <select name="year" id="year" class="filter-select">
                <option value="">All Years</option>
                {% for y in available_years %}
                    <option value="{{ y }}" {% if year == y|stringformat:"s" %}selected{% endif %}>
                        {{ y }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div class="filter-group">
            <label for="course">ğŸ“š Course</label>
            <select name="course" id="course" class="filter-select">
                <option value="">All Courses</option>
                <option value="MS-CIT" {% if course == "MS-CIT" %}selected{% endif %}>MS-CIT</option>
                <option value="Tally" {% if course == "Tally" %}selected{% endif %}>Tally</option>
                <option value="Advance Excel" {% if course == "Advance Excel" %}selected{% endif %}>Advance Excel</option>
                <option value="IOT" {% if course == "IOT" %}selected{% endif %}>IOT</option>
                <option value="Scratch" {% if course == "Scratch" %}selected{% endif %}>Scratch</option>
                <option value="Other" {% if course == "Other" %}selected{% endif %}>Other</option>
            </select>
        </div>

        <div class="filter-buttons">
            <button type="submit" class="filter-btn apply">
                ğŸ” Apply Filters
            </button>
            <a href="{% url 'admitted_students' %}" class="filter-btn reset">
                ğŸ”„ Reset
            </a>
        </div>
    </form>
</div>

<!-- RESULTS SUMMARY -->
{% if search or month or year or course %}
<div class="results-summary">
    <p>
        Showing <strong>{{ students|length }}</strong> student{{ students|length|pluralize }}
        {% if search %}matching "{{ search }}"{% endif %}
        {% if course %}in {{ course }}{% endif %}
        {% if month %}for month {{ month }}{% endif %}
        {% if year %}in year {{ year }}{% endif %}
    </p>
</div>
{% endif %}

<!-- STUDENTS GRID -->
<div class="students-container">
    <div class="students-grid">
        {% if students %}
            {% for student in students %}
            <div class="student-card" onclick="openStudentModal({{ student.id }})">
                <!-- Photo -->
                <div class="student-photo">
                    {% if student.photo %}
                        <img src="{{ student.photo.url }}" alt="{{ student.full_name }}">
                    {% else %}
                        <div class="photo-placeholder">
                            {{ student.student_name|slice:":1"|upper }}
                        </div>
                    {% endif %}
                </div>
                
                <!-- Student Info -->
                <div class="student-info">
                    <h3 class="student-name">{{ student.full_name }}</h3>
                    
                    <div class="student-details">
                        <div class="detail-item">
                            <span class="detail-icon">ğŸ“</span>
                            <span>{{ student.mobile_own }}</span>
                        </div>
                        
                        <div class="detail-item fees">
                            <span class="detail-icon">ğŸ’°</span>
                            <span>Remaining: â‚¹5,000</span>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="empty-state" style="grid-column: 1 / -1;">
                <div class="empty-icon">ğŸ“­</div>
                <p>No students found</p>
                {% if search or month or year or course %}
                    <small>Try adjusting your filters</small>
                    <br><br>
                    <a href="{% url 'admitted_students' %}" class="btn-primary">Show All Students</a>
                {% else %}
                    <small>Start by adding your first student</small>
                    <br><br>
                    <a href="{% url 'new_admission' %}" class="btn-primary">Add First Student</a>
                {% endif %}
            </div>
        {% endif %}
    </div>
</div>

<!-- STUDENT DETAIL MODAL (same as before) -->
<div id="studentModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2>ğŸ“‹ Student Details</h2>
        
        <form id="studentForm" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="hidden" id="studentId" name="student_id">
            
            <div class="form-grid">
                <!-- Photo Section -->
                <div class="photo-section">
                    <label class="photo-label">Student Photo</label>
                    <div class="modal-photo">
                        <img id="modalPhoto" src="" alt="Student Photo">
                    </div>
                    <input type="file" id="photoInput" name="photo" accept="image/*" style="display:none;">
                    <button type="button" class="change-photo-btn" onclick="document.getElementById('photoInput').click()">
                        ğŸ“· Change Photo
                    </button>
                </div>

                <!-- Personal Information -->
                <div class="form-section">
                    <h3>ğŸ‘¤ Personal Information</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Student Name <span class="required">*</span></label>
                            <input type="text" id="studentName" name="student_name" required>
                        </div>
                        <div class="form-group">
                            <label>Father Name <span class="required">*</span></label>
                            <input type="text" id="fatherName" name="father_name" required>
                        </div>
                        <div class="form-group">
                            <label>Surname <span class="required">*</span></label>
                            <input type="text" id="surname" name="surname" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group full-width">
                            <label>Full Name (Auto-generated)</label>
                            <input type="text" id="fullName" name="full_name" readonly class="readonly">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Mother Name <span class="required">*</span></label>
                            <input type="text" id="motherName" name="mother_name" required>
                        </div>
                        <div class="form-group">
                            <label>Date of Birth <span class="required">*</span></label>
                            <input type="date" id="dob" name="date_of_birth" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Gender <span class="required">*</span></label>
                            <select id="gender" name="gender" required>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Marital Status <span class="required">*</span></label>
                            <select id="maritalStatus" name="marital_status" required>
                                <option value="Single">Single</option>
                                <option value="Married">Married</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Contact Information -->
                <div class="form-section">
                    <h3>ğŸ“ Contact Information</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Mobile (Own) <span class="required">*</span></label>
                            <input type="tel" id="mobileOwn" name="mobile_own" pattern="[0-9]{10}" required>
                        </div>
                        <div class="form-group">
                            <label>Parent Mobile</label>
                            <input type="tel" id="parentMobile" name="parent_mobile" pattern="[0-9]{10}">
                        </div>
                    </div>
                </div>

                <!-- Course Information -->
                <div class="form-section">
                    <h3>ğŸ“š Course Information</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Course <span class="required">*</span></label>
                            <select id="courseSelect" name="course" required>
                                <option value="MS-CIT">MS-CIT</option>
                                <option value="Tally">Tally</option>
                                <option value="Advance Excel">Advance Excel</option>
                                <option value="IOT">IOT</option>
                                <option value="Scratch">Scratch</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Custom Course</label>
                            <input type="text" id="customCourse" name="custom_course" placeholder="If Other selected">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group full-width">
                            <label>Educational Qualification <span class="required">*</span></label>
                            <input type="text" id="qualification" name="educational_qualification" required>
                        </div>
                    </div>
                </div>

                <!-- Address Information -->
                <div class="form-section">
                    <h3>ğŸ  Address</h3>
                    
                    <div class="form-row">
                        <div class="form-group full-width">
                            <label>Address <span class="required">*</span></label>
                            <textarea id="address" name="address" rows="2" required></textarea>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>City <span class="required">*</span></label>
                            <input type="text" id="city" name="city" required>
                        </div>
                        <div class="form-group">
                            <label>Tehsil/Block <span class="required">*</span></label>
                            <input type="text" id="tehsil" name="tehsil_block" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>District <span class="required">*</span></label>
                            <input type="text" id="district" name="district" required>
                        </div>
                        <div class="form-group">
                            <label>Pin Code <span class="required">*</span></label>
                            <input type="text" id="pinCode" name="pin_code" pattern="[0-9]{6}" required>
                        </div>
                    </div>
                </div>

                <!-- Financial Information -->
                <div class="form-section financial-section">
                    <h3>ğŸ’° Financial Information</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Total Fees (â‚¹) <span class="required">*</span></label>
                            <input type="number" id="totalFees" name="total_fees" step="0.01" min="0" value="5000" required>
                        </div>
                        <div class="form-group">
                            <label>Paid Fees (â‚¹)</label>
                            <input type="number" id="paidFees" name="paid_fees" step="0.01" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label>Remaining Fees (â‚¹)</label>
                            <input type="number" id="remainingFees" readonly class="readonly">
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-actions">
                <button type="submit" class="save-btn">ğŸ’¾ Save Changes</button>
                <button type="button" class="cancel-btn" onclick="closeModal()">âŒ Cancel</button>
            </div>
        </form>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="{% static 'core/admitted_students.js' %}"></script>
{% endblock %}