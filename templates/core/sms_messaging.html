{% extends 'base/base.html' %}
{% load static %}

{% block title %}SMS Messaging{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'core/sms_messaging.css' %}">
{% endblock %}

{% block page_heading %}
<div class="page-header">
    <div class="page-header-content">
        <div class="page-title-wrapper">
            <div class="page-icon">ğŸ’¬</div>
            <div>
                <h1 class="page-title">SMS Messaging</h1>
                <p class="page-subtitle">Send messages to students</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block content %}

<!-- FILTERS SECTION -->
<div class="filters-container">
    <form class="filters-form" onsubmit="event.preventDefault();">
        
        <div class="filter-group">
            <label for="monthFilter">ğŸ“… Select Month</label>
            <select id="monthFilter" class="filter-select">
                <option value="">All Months</option>
                <option value="1">January</option>
                <option value="2">February</option>
                <option value="3">March</option>
                <option value="4">April</option>
                <option value="5">May</option>
                <option value="6">June</option>
                <option value="7">July</option>
                <option value="8">August</option>
                <option value="9">September</option>
                <option value="10">October</option>
                <option value="11">November</option>
                <option value="12">December</option>
            </select>
        </div>

        <div class="filter-group">
            <label for="yearFilter">ğŸ“† Select Year</label>
            <select id="yearFilter" class="filter-select">
                <option value="">All Years</option>
                {% for year in available_years %}
                    <option value="{{ year }}">{{ year }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="filter-buttons">
            <button type="button" id="applyFilterBtn" class="filter-btn apply">
                ğŸ” Load Students
            </button>
        </div>
    </form>
</div>

<!-- STUDENTS SELECTION SECTION -->
<div class="students-section">
    <h3>ğŸ‘¥ Select Students</h3>
    
    <div id="selectionHeader" class="selection-header" style="display: none;">
        <div class="select-all-container">
            <input type="checkbox" id="selectAllCheckbox" class="select-all-checkbox">
            <label for="selectAllCheckbox" class="select-all-label">Select All</label>
        </div>
        <div class="selected-count">
            Selected: <span id="selectedCount">0</span>
        </div>
    </div>
    
    <div id="studentsGrid" class="students-grid">
        <!-- Students will be loaded here dynamically -->
    </div>
    
    <div id="emptyState" class="empty-state">
        <div class="empty-icon">ğŸ‘¥</div>
        <p>Select filters above and click "Load Students" to view students</p>
    </div>
</div>

<!-- MESSAGE SECTION -->
<div class="message-section">
    <h3>âœ‰ï¸ Compose Message</h3>
    
    <form class="message-form" onsubmit="event.preventDefault();">
        <div class="form-group">
            <label for="messageText">
                Message <span class="required">*</span>
                <span class="char-count" id="charCount">0/160</span>
            </label>
            <textarea
                id="messageText"
                class="message-textarea"
                placeholder="Type your message here..."
                maxlength="160"
            ></textarea>
        </div>
        
        <div class="message-info">
            <p>
                <span class="info-icon">â„¹ï¸</span>
                <strong>SMS will be sent to selected students only</strong>
            </p>
            <p>
                <span class="info-icon">ğŸ“±</span>
                Keep your message within 160 characters for single SMS
            </p>
            <p>
                <span class="info-icon">ğŸ’¡</span>
                Fee payment SMS is sent automatically when payment is recorded
            </p>
        </div>
        
        <div class="form-actions">
            <button type="button" id="sendMessageBtn" class="btn-send">
                ğŸ“¤ Send SMS
            </button>
            <button type="button" id="clearMessageBtn" class="btn-clear">
                ğŸ—‘ï¸ Clear
            </button>
        </div>
    </form>
</div>

<!-- LOADING OVERLAY -->
<div id="loadingOverlay" class="loading-overlay">
    <div class="loading-content">
        <div class="spinner"></div>
        <p id="loadingMessage">Loading...</p>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="{% static 'core/sms_messaging.js' %}"></script>
{% endblock %}